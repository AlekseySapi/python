import random
import time


YIN = "__  __"
YANG = "______"


def get_hexagram_num(coin_sums):
    # Преобразуем суммы в биты (Инь=0, Ян=1)
    bits = [1 if s in (7, 9) else 0 for s in coin_sums]
    
    # Конвертируем в число (нижняя черта - младший бит)
    binary_index = (bits[0] * 1 + bits[1] * 2 + bits[2] * 4 + 
                bits[3] * 8 + bits[4] * 16 + bits[5] * 32)
    
    # Таблица соответствия бинарного индекса каноническому номеру
    binary_to_wen_wang = [
		2, 23, 8, 20, 16, 35, 45, 12,
		15, 52, 39, 53, 62, 56, 31, 33,
		7, 4, 29, 59, 40, 64, 47, 6,
		46, 18, 48, 57, 32, 50, 28, 44,
		24, 27, 3, 42, 51, 21, 17, 25,
		36, 22, 63, 37, 55, 30, 49, 13,
		19, 41, 60, 61, 54, 38, 58, 10,
		11, 26, 5, 9, 34, 14, 43, 1
	]
    
    return binary_to_wen_wang[binary_index]


# Названия и краткие значения гексаграмм
hexagrams_info = {
    1:  ("Цянь 乾 (Qián)", "Сила творчества и инициативы.\n   Действуй решительно. У тебя есть энергия и потенциал. Задавай тон, но сохраняй ясность и осторожность."),
    2:  ("Кунь 坤 (Kūn)", "Восприимчивость и поддержка Земли.\n   Прими обстоятельства и не форсируй. Действуй мягко и заботливо, используй поддержку окружающих."),
    3:  ("Чжунь 屯 (Zhūn)", "Начальные трудности при зарождении дела.\n   Будь терпелив. Собирай информацию, проси совета и аккуратно устраняй препятствия."),
    4:  ("Мэн 蒙 (Méng)", "Незрелость и обучение.\n   Учись смиренно и ищи наставника. Не делай резких выводов, пока не разобрался."),
    5:  ("Сюй 需 (Xū)", "Ожидание и подготовка.\n   Подготовься и выжди момент. Терпение и планирование принесут удачу."),
    6:  ("Сун 訟 (Sòng)", "Спор и конфликт.\n   Не усугубляй разногласия. Стремись к честному разрешению или уступке ради общего блага."),
    7:  ("Ши 師 (Shī)", "Организация и дисциплина.\n   Веди людей своим примером. Строй порядок, действуй ответственно и терпеливо."),
    8:  ("Би 比 (Bǐ)", "Солидарность и единство.\n   Строй доверие и выбирай союзников мудро. Вместе вы сильнее, если есть искренность и честность."),
    9:  ("Сяо Чу 小畜 (Xiǎo Xù)", "Малое накопление и сдержанность.\n   Ограничь свои амбиции. Копи силы и ресурсы, чтобы использовать их в нужный момент."),
    10: ("Люй 履 (Lǚ)", "Осмотрительность и правильное поведение.\n   Действуй аккуратно. Уважай границы и соблюдай порядок - это принесёт успех."),
    11: ("Тай 泰 (Tài)", "Гармония и процветание.\n   Используй благоприятный период для укрепления основ и помощи другим."),
    12: ("Пи 否 (Pǐ)", "Застой и препятствия.\n   Не форсируй события. Укрепляй фундамент и готовься к переменам внутренне."),
    13: ("Тун Жэнь 同人 (Tóng Rén)", "Общность и товарищество.\n   Объединяйся с людьми искренне. Действуй ради общей цели и будь честен в общении."),
    14: ("Да Ю 大有 (Dà Yǒu)", "Большое обладание и успех.\n   Пользуйся успехом разумно. Щедрость и ответственность сохранят положение."),
    15: ("Цянь 謙 (Qiān)", "Смирение и умеренность.\n   Проявляй скромность. Она привлекает поддержку и убережёт от падения."),
    16: ("Юй 豫 (Yù)", "Воодушевление и подготовка.\n   Вдохновляй и планируй. Используй энергию для организованных шагов."),
    17: ("Суй 隨 (Suí)", "Следование и гибкость.\n   Приспосабливайся к лидерам и обстоятельствам, но сохраняй собственную честность."),
    18: ("Гу 蠱 (Gǔ)", "Исправление порчи и очищение.\n   Возьмись за устранение старых ошибок. Искренне работай над восстановлением порядка."),
    19: ("Линь 臨 (Lín)", "Приближение и влияние.\n   Используй положение, чтобы помочь другим. Действуй мягко и ответственно."),
    20: ("Гуань 觀 (Guān)", "Созерцание и обзор.\n   Отойди и посмотри на ситуацию со стороны. Понимание подскажет, что делать дальше."),
    21: ("Ши Кэ 噬嗑 (Shì Kè)", "Прорыв через препятствие.\n   Прими решительные меры против того, что мешает. Опирайся на принцип и порядок."),
    22: ("Би 賁 (Bì)", "Украшение и презентация.\n   Улучшай внешний вид дела, но помни про содержание. Вид привлекает, суть удерживает."),
    23: ("Бо 剝 (Bō)", "Отслаивание и упадок.\n   Отпусти то, что отмирает. Освобождение создаёт место для нового."),
    24: ("Фу 復 (Fù)", "Возвращение и обновление.\n   Вернись к правильному пути. Используй шанс начать снова с уроками прошлого."),
    25: ("У Ван 无妄 (Wú Wàng)", "Невинность и искренность.\n   Действуй естественно и честно. Не усложняй намерения - искренность ведёт к успеху."),
    26: ("Да Чу 大畜 (Dà Chù)", "Великая сдерживающая сила.\n   Накопи ресурсы и влияние. Терпение и сдержанность принесут пользу."),
    27: ("И 頤 (Yí)", "Питание и забота о себе.\n   Заботься о теле и духе. Правильное питание и привычки укрепят тебя."),
    28: ("Да Го 大過 (Dà Guò)", "Большая нагрузка и чрезмерность.\n   Признай свои пределы. Пересмотри обязанности и укрепи опору, прежде чем продолжать."),
    29: ("Кань 坎 (Kǎn)", "Опасность и испытания.\n   Проходи через трудности спокойно и решительно. Не поддавайся страху, ищи устойчивость внутри."),
    30: ("Ли 離 (Lí)", "Ясность и свет.\n   Следуй истине и держи внутренний свет. Освещай путь себе и другим."),
    31: ("Сянь 咸 (Xián)", "Взаимное притяжение и влияние.\n   Будь искренним в отношениях. Уважай границы и не дави на чувства других."),
    32: ("Хэн 恆 (Héng)", "Постоянство и верность пути.\n   Будь устойчив и последователен. Верность выбранному пути принесёт плоды."),
    33: ("Дунь 遯 (Dùn)", "Отступление с достоинством.\n   Умей отойти вовремя. Это сохранит силы и репутацию для будущих шагов."),
    34: ("Да Чжуан 大壯 (Dà Zhuàng)", "Великая сила и активность.\n   Применяй силу разумно. Действуй смело, но не бездумно и контролируй амбиции."),
    35: ("Цзинь 晉 (Jìn)", "Продвижение и расцвет.\n   Пользуйся моментом для роста. Укрепляй достижения и не забывай о смирении."),
    36: ("Мин И 明夷 (Míng Yí)", "Помрачение света.\n   Сохраняй внутреннюю ясность в сложных условиях. Скрывай силу и береги душевный свет."),
    37: ("Цзя Жэнь 家人 (Jiā Rén)", "Дом, семья и порядок.\n   Заботься о домашней гармонии. Ясные роли и ответственность укрепят связи."),
    38: ("Куй 睽 (Kuí)", "Различие и противопоставление.\n   Признай различия и ищи точки соприкосновения. Если нужно, отойди - не навязывай согласие силой."),
    39: ("Цзянь 蹇 (Jiǎn)", "Затруднение и препятствие.\n   Не спеши. Ищи помощь и правильное направление - упорство приведёт к решению."),
    40: ("Се 解 (Xiè)", "Освобождение и разрешение трудностей.\n   Отпусти напряжение и очисти путь. Прощение и ясность принесут облегчение."),
    41: ("Сунь 損 (Sǔn)", "Уменьшение и освобождение от лишнего.\n   Откажись от избыточного. Простота даст внутреннее равновесие."),
    42: ("И 益 (Yì)", "Увеличение и приумножение.\n   Делай шаги, которые принесут рост. Будь щедр и учитывай пользу для других."),
    43: ("Гуай 夬 (Guài)", "Решительный прорыв.\n   Действуй решительно, когда время пришло. Чёткое намерение откроет путь, но избегай грубой силы."),
    44: ("Гоу 姤 (Gòu)", "Неожиданная встреча и искушение.\n   Будь осмотрителен в новых связях. Держи границы и не позволяй импульсу вести за собой."),
    45: ("Цуй 萃 (Cuì)", "Собрание и объединение людей.\n   Объединяйся ради честной цели. Следи за чистотой намерений и организацией."),
    46: ("Шэн 升 (Shēng)", "Подъём и постепенный рост.\n   Двигайся вверх шаг за шагом. Скромность и труд обеспечат устойчивое продвижение."),
    47: ("Кунь 困 (Kùn)", "Истощение и ограничение.\n   Сохрани силы. Экономь ресурсы, ищи поддержку и путь восстановления."),
    48: ("Цзин 井 (Jǐng)", "Колодец - источник общих ресурсов.\n   Заботься о ресурсах и делись ими. Регулярный уход поддержит источник для всех."),
    49: ("Гэ 革 (Gé)", "Перемена и обновление.\n   Измени то, что устарело. Делай шаги осознанно и с ясным намерением."),
    50: ("Дин 鼎 (Dǐng)", "Котёл - прочная основа и питание духа.\n   Укрепляй фундамент и традиции. Забота о корнях придаст силу и устойчивость."),
    51: ("Чжэнь 震 (Zhèn)", "Пробуждение и внезапное движение.\n   Используй потрясение как возможность действовать. Сохраняй спокойствие и ясность."),
    52: ("Гэнь 艮 (Gèn)", "Покой и устойчивость.\n   Остановись и укрепись внутри. Внутренний покой рождает правильное действие."),
    53: ("Цзянь 漸 (Jiàn)", "Постепенное развитие.\n   Продвигайся медленно и уверенно. Стабильный рост важнее быстрых скачков."),
    54: ("Гуй Мэй 歸妹 (Guī Mèi)", "Молодая невеста и новые связи.\n   Вступай в новые отношения осмотрительно. Смирение и уважение помогут найти своё место."),
    55: ("Фэн 豐 (Fēng)", "Изобилие и полнота.\n   Пользуйся плодами, но действуй мудро и щедро. Не забывай о балансе."),
    56: ("Люй 旅 (Lǚ)", "Путешествие и положение вне дома.\n   Будь внимателен в дороге. Адаптируйся к местным правилам и сохраняй осторожность."),
    57: ("Сунь 巽 (Xùn)", "Проникновение мягким влиянием.\n   Убеждай мягко и тонко. Постепенное влияние эффективнее прямого давления."),
    58: ("Дуй 兌 (Duì)", "Радость и общение.\n   Поддерживай лёгкость и общительность, но не теряй глубины и искренности."),
    59: ("Хуань 渙 (Huàn)", "Рассеяние застойных форм.\n   Очисти пространство и связи. Освобождайся от застоя, чтобы прийти в движение."),
    60: ("Цзэ 節 (Jié)", "Ограничение и мера.\n   Установи границы и соблюдай меру. Правила сохранят форму и уберегут от излишка."),
    61: ("Чжун Фу 中孚 (Zhōng Fú)", "Внутренняя искренность и доверие.\n   Будь верен словам и обещаниям. Искренность укрепит влияние и связи."),
    62: ("Сяо Го 小過 (Xiǎo Guò)", "Малые превышения и детали.\n   Следи за мелочами. Мелкие ошибки не доводи до большого конфликта и корректируй сразу."),
    63: ("Цзи Цзи 既濟 (Jì Jì)", "Уже завершено - переходный момент.\n   Держи бдительность после успеха. Доводи до конца детали и не расслабляйся преждевременно."),
    64: ("Вэй Цзи 未濟 (Wèi Jì)", "Ещё не завершено - на грани завершения.\n   Доведи дело до конца осторожно. Один неверный шаг может помешать успеху.")
}


def show_hexagram_info(n):
	name, meaning = hexagrams_info[n]
	print()
	print(f"     Гексаграмма №{n} - {name}")
	print(f"    Значение: {meaning}\n")


# Персонализация
question = input("\n  Ваш вопрос к [И цзин]:\n> ")
q_seed = sum(ord(char) for char in question)

print()
print()
n = 6
coin_sum = []
for i in range(n):
	print(f"  Бросок монет №{i+1}\n Сосредоточьтесь на вашем вопросе и нажмите [Enter]..")
	input()

	# Уникальный сид для каждого броска
	throw_seed = q_seed + i + int(time.time() * 1000) % 10000
	random.seed(throw_seed)
	print(f"[seed = {throw_seed}]\n")
	time.sleep(0.5)

	k = 3
	total = 0
	for j in range(k):
		coin = random.randint(2, 3)
		if coin == 3:
			print(f" > Орёл (3 очка)")
		else:
			print(f" > Решка (2 очка)")
		total = total + coin
	print(f"\n  (Сумма: {total})\n")
	coin_sum.append(total)
	print()
	time.sleep(1)


nl = 0
print("\n  << Текущая ситуация (Что происходит сейчас) >>")
hex_num = get_hexagram_num(coin_sum)
show_hexagram_info(hex_num)
for s in coin_sum:
	if nl == 3: print()
	if s == 7 or s == 9:
		print(f"      {YANG}   <{s}>")
	else:
		print(f"      {YIN}   <{s}>")
	nl = nl + 1


print()
print()

hide_sum = []
hide_sum.append(coin_sum[1])
hide_sum.append(coin_sum[2])
hide_sum.append(coin_sum[3])
hide_sum.append(coin_sum[2])
hide_sum.append(coin_sum[3])
hide_sum.append(coin_sum[4])

nl = 0
print("\n  << Скрытый аспект (Что скрыто внутри) >>")
hide_num = get_hexagram_num(hide_sum)
show_hexagram_info(hide_num)
for s in hide_sum:
	if nl == 3: print()
	if s == 7 or s == 9:
		print(f"      {YANG}   <{s}>")
	else:
		print(f"      {YIN}   <{s}>")
	nl = nl + 1


print()
print()

future_sum = []		
for s in coin_sum:
	if s == 6:
		future_sum.append(7)
	elif s == 9:
		future_sum.append(8)
	else:
		future_sum.append(s)

nl = 0
print("\n\n  << Грядущие перемены (Куда это ведёт) >>")
future_num = get_hexagram_num(future_sum)
show_hexagram_info(future_num)
for s in future_sum:
	if nl == 3: print()
	if s == 7 or s == 9:
		print(f"      {YANG}   <{s}>")
	else:
		print(f"      {YIN}   <{s}>")
	nl = nl + 1


print()
print()
input()